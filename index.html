<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="×× ×”×œ ××©×™××•×ª ××™×©×™">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="××©×™××•×ª">
    <title>×× ×”×œ ××©×™××•×ª ××™×©×™</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .sync-date {
            background: #f0fdf4;
            border: 1px solid #86efac;
            color: #166534;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 10px;
            display: inline-block;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #10b981;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .btn-delete {
            background: #ef4444;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .btn-orange {
            background: #f59e0b;
        }

        .btn-orange:hover {
            background: #d97706;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .sync-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .sync-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .list-selector {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .list-control {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .task-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .task-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-right: 5px solid #667eea;
            transition: all 0.3s;
            cursor: pointer;
        }

        .task-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .task-item.completed {
            opacity: 0.6;
            border-right-color: #10b981;
        }

        .task-item.selected {
            border: 3px solid #667eea;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-title {
            font-size: 18px;
            font-weight: bold;
            flex: 1;
            padding-left: 10px;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: #6b7280;
        }

        .task-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .badge-category {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-priority-×’×‘×•×” {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-priority-×¨×’×™×œ {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-priority-× ××•×š {
            background: #f3f4f6;
            color: #374151;
        }

        .task-notes {
            background: #fef3c7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .hidden {
            display: none;
        }

        .status-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: #f3f4f6;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
        }

        .notes-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }

            .sync-buttons {
                flex-direction: column;
            }

            .task-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ×× ×”×œ ××©×™××•×ª ××™×©×™</h1>
            <p style="color: #6b7280; margin-top: 10px;">× ×™×”×•×œ ××©×™××•×ª ×—×›× ×¢× ××™×–×•×’ ××•×˜×•××˜×™</p>
            <div id="lastSyncDate" class="sync-date hidden"></div>
        </div>

        <div id="statusMessage"></div>

        <!-- Sync Section -->
        <div class="sync-section">
            <h2 style="margin-bottom: 15px;">ğŸ’¾ ×’×™×‘×•×™ ×•×¡× ×›×¨×•×Ÿ</h2>
            <div class="sync-buttons">
                <button onclick="exportData()" class="btn btn-secondary">
                    ğŸ“¥ ×™×™×¦× ×œ×§×•×‘×¥
                </button>
                <label class="btn btn-orange" style="margin: 0; cursor: pointer;">
                    ğŸ“¤ ×™×™×‘× ××§×•×‘×¥ (××™×–×•×’ ×—×›×)
                    <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                </label>
            </div>
            <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">
                ğŸ’¡ ×”×™×™×‘×•× ××–×”×” ×©×™× ×•×™×™× ×—×“×©×™× ×•××©×œ×‘ ××•×ª× ××•×˜×•××˜×™×ª ×œ×œ× ××—×™×§×ª × ×ª×•× ×™×
            </p>
        </div>

        <!-- List Selector -->
        <div class="list-selector">
            <label style="font-weight: bold; display: block; margin-bottom: 10px;">ğŸ“‹ ×‘×—×¨ ×¨×©×™××”:</label>
            <div class="list-control">
                <select id="listSelector" onchange="loadTasks()" style="flex: 1;">
                    <option value="×¤×¨×•×™×§×˜ ××ª××˜×™×§×”">×¤×¨×•×™×§×˜ ××ª××˜×™×§×”</option>
                </select>
                <button onclick="showDeleteListConfirm()" class="btn btn-delete btn-small">ğŸ—‘ï¸</button>
            </div>
            <button onclick="showNewListForm()" class="btn btn-secondary" style="width: 100%;">
                + ×¨×©×™××” ×—×“×©×”
            </button>
            <div id="newListForm" class="hidden" style="margin-top: 15px;">
                <input type="text" id="newListName" placeholder="×©× ×”×¨×©×™××” ×”×—×“×©×”...">
                <div style="display: flex; gap: 10px;">
                    <button onclick="createNewList()" class="btn btn-secondary" style="flex: 1;">×™×¦×™×¨×”</button>
                    <button onclick="hideNewListForm()" class="btn" style="flex: 1; background: #6b7280;">×‘×™×˜×•×œ</button>
                </div>
            </div>
            <div id="deleteListConfirm" class="hidden" style="margin-top: 15px; padding: 15px; background: #fee2e2; border-radius: 8px;">
                <p style="color: #991b1b; font-weight: bold; margin-bottom: 10px;">
                    âš ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×¨×©×™××”?
                </p>
                <div style="display: flex; gap: 10px;">
                    <button onclick="deleteList()" class="btn btn-delete" style="flex: 1;">×›×Ÿ, ××—×§</button>
                    <button onclick="hideDeleteListConfirm()" class="btn" style="flex: 1; background: #6b7280;">×‘×™×˜×•×œ</button>
                </div>
            </div>
            <div class="stats" style="margin-top: 15px;">
                <span class="stat-item">âœ… ×”×•×©×œ××•: <strong id="completedCount">0</strong></span>
                <span class="stat-item">â³ ×¤×¢×™×œ×•×ª: <strong id="activeCount">0</strong></span>
                <span class="stat-item">ğŸ“Š ×¡×”"×›: <strong id="totalCount">0</strong></span>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <label style="font-weight: bold; display: block; margin-bottom: 10px;">ğŸ” ×¡×™× ×•×Ÿ:</label>
            <select id="filterCategory" onchange="renderTasks()">
                <option value="×”×›×œ">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                <option value="×›×œ×œ×™">×›×œ×œ×™</option>
                <option value="×¢×™×¦×•×‘ ×××©×§">×¢×™×¦×•×‘ ×××©×§</option>
                <option value="×ª×›× ×™× ×—×™× ×•×›×™×™×">×ª×›× ×™× ×—×™× ×•×›×™×™×</option>
                <option value="×¤×™×¦'×¨×™× ×˜×›× ×™×™×">×¤×™×¦'×¨×™× ×˜×›× ×™×™×</option>
                <option value="××¢×¨×›×ª ×ª×©×œ×•×">××¢×¨×›×ª ×ª×©×œ×•×</option>
                <option value="×—×•×•×™×™×ª ××©×ª××©">×—×•×•×™×™×ª ××©×ª××©</option>
                <option value="×©×™×•×•×§">×©×™×•×•×§</option>
                <option value="×‘×“×™×§×•×ª">×‘×“×™×§×•×ª</option>
                <option value="×¡×•×›×Ÿ AI">×¡×•×›×Ÿ AI</option>
            </select>
        </div>

        <!-- Tasks List -->
        <div id="tasksList"></div>

        <!-- Task Form -->
        <div class="task-form">
            <h2 style="margin-bottom: 15px;" id="formTitle">â• ××©×™××” ×—×“×©×”</h2>
            <input type="text" id="taskTitle" placeholder="×ª×™××•×¨ ×”××©×™××”...">
            
            <select id="taskCategory">
                <option value="×›×œ×œ×™">×›×œ×œ×™</option>
                <option value="×¢×™×¦×•×‘ ×××©×§">×¢×™×¦×•×‘ ×××©×§</option>
                <option value="×ª×›× ×™× ×—×™× ×•×›×™×™×">×ª×›× ×™× ×—×™× ×•×›×™×™×</option>
                <option value="×¤×™×¦'×¨×™× ×˜×›× ×™×™×">×¤×™×¦'×¨×™× ×˜×›× ×™×™×</option>
                <option value="××¢×¨×›×ª ×ª×©×œ×•×">××¢×¨×›×ª ×ª×©×œ×•×</option>
                <option value="×—×•×•×™×™×ª ××©×ª××©">×—×•×•×™×™×ª ××©×ª××©</option>
                <option value="×©×™×•×•×§">×©×™×•×•×§</option>
                <option value="×‘×“×™×§×•×ª">×‘×“×™×§×•×ª</option>
                <option value="×¡×•×›×Ÿ AI">×¡×•×›×Ÿ AI</option>
            </select>

            <select id="taskPriority">
                <option value="×¨×’×™×œ">×¢×“×™×¤×•×ª ×¨×’×™×œ×”</option>
                <option value="×’×‘×•×”">×¢×“×™×¤×•×ª ×’×‘×•×”×”</option>
                <option value="× ××•×š">×¢×“×™×¤×•×ª × ××•×›×”</option>
            </select>

            <textarea id="taskNotes" placeholder="×”×¢×¨×•×ª (××•×¤×¦×™×•× ×œ×™)" rows="3"></textarea>

            <div style="display: flex; gap: 10px;">
                <button onclick="saveTask()" class="btn" style="flex: 1;" id="saveBtn">â• ×”×•×¡×£ ××©×™××”</button>
                <button onclick="cancelEdit()" class="btn hidden" style="flex: 1; background: #6b7280;" id="cancelBtn">×‘×™×˜×•×œ</button>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="notes-section">
            <h2 style="margin-bottom: 15px;">ğŸ“ ×”×¢×¨×•×ª ×•×”×“×‘×§×•×ª</h2>
            <textarea id="generalNotes" placeholder="×›×ª×•×‘ ×›××Ÿ ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª, ×¨×¢×™×•× ×•×ª, ×§×™×©×•×¨×™×..." style="min-height: 150px;"></textarea>
            <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">
                ×”×”×¢×¨×•×ª × ×©××¨×•×ª ××•×˜×•××˜×™×ª âœ“
            </p>
        </div>
    </div>

    <script>
        let tasks = [];
        let lists = ['×¤×¨×•×™×§×˜ ××ª××˜×™×§×”'];
        let currentList = '×¤×¨×•×™×§×˜ ××ª××˜×™×§×”';
        let editingTaskId = null;
        let generalNotes = '';
        let lastSyncDate = null;

        // Load data on startup
        window.onload = () => {
            loadFromLocal();
            renderTasks();
            updateListSelector();
            updateStats();
            updateSyncDate();
        };

        function loadFromLocal() {
            const savedTasks = localStorage.getItem('mathWebsiteTasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks).map(task => ({
                    ...task,
                    listName: task.listName || '×¤×¨×•×™×§×˜ ××ª××˜×™×§×”'
                }));
            }

            const savedLists = localStorage.getItem('mathWebsiteLists');
            if (savedLists) {
                lists = JSON.parse(savedLists);
            }

            const savedNotes = localStorage.getItem('mathWebsiteNotes');
            if (savedNotes) {
                generalNotes = savedNotes;
                document.getElementById('generalNotes').value = generalNotes;
            }

            const savedSyncDate = localStorage.getItem('mathWebsiteLastSync');
            if (savedSyncDate) {
                lastSyncDate = savedSyncDate;
            }
        }

        function saveToLocal() {
            localStorage.setItem('mathWebsiteTasks', JSON.stringify(tasks));
            localStorage.setItem('mathWebsiteLists', JSON.stringify(lists));
            localStorage.setItem('mathWebsiteNotes', generalNotes);
        }

        function updateSyncDate() {
            const syncDateEl = document.getElementById('lastSyncDate');
            if (lastSyncDate) {
                const date = new Date(lastSyncDate);
                syncDateEl.textContent = `ğŸ“¥ ×™×™×‘×•× ××—×¨×•×Ÿ: ${date.toLocaleDateString('he-IL')} ${date.toLocaleTimeString('he-IL', {hour: '2-digit', minute: '2-digit'})}`;
                syncDateEl.classList.remove('hidden');
            }
        }

        document.getElementById('generalNotes').addEventListener('input', (e) => {
            generalNotes = e.target.value;
            saveToLocal();
        });

        function showStatus(message) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        function exportData() {
            const dataToExport = {
                tasks,
                lists,
                notes: generalNotes,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tasks-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showStatus('âœ… ×”×§×•×‘×¥ ×”×•×¨×“ ×‘×”×¦×œ×—×”!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.tasks && importedData.lists) {
                        // Smart merge logic
                        const merged = mergeData(importedData);
                        
                        tasks = merged.tasks;
                        lists = merged.lists;
                        
                        // Merge notes - keep the longer one
                        if (importedData.notes && importedData.notes.length > generalNotes.length) {
                            generalNotes = importedData.notes;
                            document.getElementById('generalNotes').value = generalNotes;
                        }
                        
                        lastSyncDate = new Date().toISOString();
                        localStorage.setItem('mathWebsiteLastSync', lastSyncDate);
                        
                        saveToLocal();
                        updateListSelector();
                        renderTasks();
                        updateStats();
                        updateSyncDate();
                        
                        showStatus(`âœ… ×”××™×–×•×’ ×”×•×©×œ×! × ×•×¡×¤×• ${merged.addedCount} ××©×™××•×ª ×—×“×©×•×ª, ×¢×•×“×›× ×• ${merged.updatedCount} ××©×™××•×ª`);
                    } else {
                        showStatus('âŒ ×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showStatus('âŒ ×©×’×™××” ×‘×™×™×‘×•× ×”×§×•×‘×¥');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function mergeData(importedData) {
            // Create a map of existing tasks by ID
            const existingTasksMap = new Map(tasks.map(t => [t.id, t]));
            let addedCount = 0;
            let updatedCount = 0;
            
            // Merge tasks
            const mergedTasks = [...tasks];
            
            importedData.tasks.forEach(importedTask => {
                const existingTask = existingTasksMap.get(importedTask.id);
                
                if (!existingTask) {
                    // New task - add it
                    mergedTasks.push(importedTask);
                    addedCount++;
                } else {
                    // Task exists - check which is newer
                    const importedDate = new Date(importedTask.createdAt || 0);
                    const existingDate = new Date(existingTask.createdAt || 0);
                    
                    // Use the newer version, or if dates are equal, prefer completed status
                    if (importedDate > existingDate || 
                        (importedDate.getTime() === existingDate.getTime() && importedTask.completed !== existingTask.completed)) {
                        const index = mergedTasks.findIndex(t => t.id === importedTask.id);
                        if (index !== -1) {
                            mergedTasks[index] = importedTask;
                            updatedCount++;
                        }
                    }
                }
            });
            
            // Merge lists - combine both
            const mergedLists = [...new Set([...lists, ...importedData.lists])];
            
            return {
                tasks: mergedTasks,
                lists: mergedLists,
                addedCount,
                updatedCount
            };
        }

        function showNewListForm() {
            document.getElementById('newListForm').classList.remove('hidden');
        }

        function hideNewListForm() {
            document.getElementById('newListForm').classList.add('hidden');
            document.getElementById('newListName').value = '';
        }

        function createNewList() {
            const name = document.getElementById('newListName').value.trim();
            if (!name) {
                showStatus('âŒ × × ×œ×”×–×™×Ÿ ×©× ×¨×©×™××”');
                return;
            }
            if (lists.includes(name)) {
                showStatus('âŒ ×¨×©×™××” ×¢× ×©× ×–×” ×›×‘×¨ ×§×™×™××ª');
                return;
            }
            
            lists.push(name);
            currentList = name;
            saveToLocal();
            updateListSelector();
            hideNewListForm();
            renderTasks();
            showStatus('âœ… ×”×¨×©×™××” × ×•×¦×¨×” ×‘×”×¦×œ×—×”');
        }

        function showDeleteListConfirm() {
            if (lists.length <= 1) {
                showStatus('âŒ ×œ× × ×™×ª×Ÿ ×œ××—×•×§ - ×—×™×™×‘×ª ×œ×”×™×©××¨ ×œ×¤×—×•×ª ×¨×©×™××” ××—×ª');
                return;
            }
            document.getElementById('deleteListConfirm').classList.remove('hidden');
        }

        function hideDeleteListConfirm() {
            document.getElementById('deleteListConfirm').classList.add('hidden');
        }

        function deleteList() {
            const tasksInList = tasks.filter(t => t.listName === currentList);
            
            if (tasksInList.length > 0) {
                if (!confirm(`×”×¨×©×™××” "${currentList}" ××›×™×œ×” ${tasksInList.length} ××©×™××•×ª. ×”×× ××ª×” ×‘×˜×•×—?`)) {
                    hideDeleteListConfirm();
                    return;
                }
            }

            lists = lists.filter(l => l !== currentList);
            tasks = tasks.filter(t => t.listName !== currentList);
            currentList = lists[0];
            
            saveToLocal();
            updateListSelector();
            hideDeleteListConfirm();
            renderTasks();
            showStatus('âœ… ×”×¨×©×™××” × ××—×§×”');
        }

        function updateListSelector() {
            const selector = document.getElementById('listSelector');
            selector.innerHTML = lists.map(list => 
                `<option value="${list}" ${list === currentList ? 'selected' : ''}>${list}</option>`
            ).join('');
        }

        function loadTasks() {
            currentList = document.getElementById('listSelector').value;
            renderTasks();
            updateStats();
        }

        function saveTask() {
            const title = document.getElementById('taskTitle').value.trim();
            if (!title) {
                showStatus('âŒ × × ×œ×”×–×™×Ÿ ×ª×™××•×¨ ××©×™××”');
                return;
            }

            if (editingTaskId) {
                // Edit existing task
                const task = tasks.find(t => t.id === editingTaskId);
                if (task) {
                    task.title = title;
                    task.category = document.getElementById('taskCategory').value;
                    task.priority = document.getElementById('taskPriority').value;
                    task.notes = document.getElementById('taskNotes').value;
                    showStatus('âœ… ×”××©×™××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”');
                }
            } else {
                // Add new task
                const task = {
                    id: Date.now(),
                    title: title,
                    category: document.getElementById('taskCategory').value,
                    priority: document.getElementById('taskPriority').value,
                    notes: document.getElementById('taskNotes').value,
                    completed: false,
                    listName: currentList,
                    createdAt: new Date().toISOString()
                };
                tasks.push(task);
                showStatus('âœ… ×”××©×™××” × ×•×¡×¤×” ×‘×”×¦×œ×—×”');
            }

            saveToLocal();
            cancelEdit();
            renderTasks();
            updateStats();
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            editingTaskId = id;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskCategory').value = task.category;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskNotes').value = task.notes || '';
            
            document.getElementById('formTitle').textContent = 'âœï¸ ×¢×¨×™×›×ª ××©×™××”';
            document.getElementById('saveBtn').textContent = 'ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×';
            document.getElementById('cancelBtn').classList.remove('hidden');
            
            // Scroll to form at bottom
            document.querySelector('.task-form').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function cancelEdit() {
            editingTaskId = null;
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskCategory').value = '×›×œ×œ×™';
            document.getElementById('taskPriority').value = '×¨×’×™×œ';
            document.getElementById('taskNotes').value = '';
            
            document.getElementById('formTitle').textContent = 'â• ××©×™××” ×—×“×©×”';
            document.getElementById('saveBtn').textContent = 'â• ×”×•×¡×£ ××©×™××”';
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        function toggleTask(id, event) {
            event.stopPropagation();
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveToLocal();
                renderTasks();
                updateStats();
            }
        }

        function deleteTask(id, event) {
            event.stopPropagation();
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××©×™××” ×–×•?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveToLocal();
                renderTasks();
                updateStats();
                showStatus('âœ… ×”××©×™××” × ××—×§×”');
            }
        }

        function updateStats() {
            const listTasks = tasks.filter(t => t.listName === currentList);
            const filterCat = document.getElementById('filterCategory').value;
            const filtered = filterCat === '×”×›×œ' ? listTasks : listTasks.filter(t => t.category === filterCat);
            
            const completed = filtered.filter(t => t.completed).length;
            const active = filtered.filter(t => !t.completed).length;
            
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('activeCount').textContent = active;
            document.getElementById('totalCount').textContent = filtered.length;
        }

        function renderTasks() {
            const filterCat = document.getElementById('filterCategory').value;
            const listTasks = tasks.filter(t => t.listName === currentList);
            const filteredTasks = filterCat === '×”×›×œ' ? listTasks : listTasks.filter(t => t.category === filterCat);
            
            const activeTasks = filteredTasks.filter(t => !t.completed);
            const completedTasks = filteredTasks.filter(t => t.completed);

            let html = '';

            if (activeTasks.length > 0) {
                html += '<h2 style="color: white; margin-bottom: 15px;">â³ ××©×™××•×ª ×¤×¢×™×œ×•×ª</h2>';
                activeTasks.forEach(task => {
                    html += renderTask(task);
                });
            }

            if (completedTasks.length > 0) {
                html += '<h2 style="color: white; margin: 30px 0 15px;">âœ… ××©×™××•×ª ×©×”×•×©×œ××•</h2>';
                completedTasks.forEach(task => {
                    html += renderTask(task);
                });
            }

            if (filteredTasks.length === 0) {
                html = '<div class="task-item" style="text-align: center; border: none;"><p>××™×Ÿ ××©×™××•×ª ×‘×¨×©×™××” ×–×• ğŸ¯</p></div>';
            }

            document.getElementById('tasksList').innerHTML = html;
            updateStats();
        }

        function renderTask(task) {
            return `
                <div class="task-item ${task.completed ? 'completed' : ''} ${editingTaskId === task.id ? 'selected' : ''}" onclick="editTask(${task.id})">
                    <div class="task-header">
                        <div class="task-title ${task.completed ? 'completed' : ''}">${task.title}</div>
                        <div class="task-actions">
                            <button onclick="toggleTask(${task.id}, event)" class="btn btn-small btn-secondary">
                                ${task.completed ? 'â†©ï¸' : 'âœ“'}
                            </button>
                            <button onclick="deleteTask(${task.id}, event)" class="btn btn-small btn-delete">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="task-meta">
                        <span class="badge badge-category">${task.category}</span>
                        <span class="badge badge-priority-${task.priority}">${task.priority}</span>
                        <span class="badge" style="background: #f3f4f6; color: #6b7280;">
                            ${new Date(task.createdAt).toLocaleDateString('he-IL')}
                        </span>
                    </div>
                    ${task.notes ? `<div class="task-notes">${task.notes}</div>` : ''}
                </div>
            `;
        }
    </script>
</body>
</html>
